---
layout: post
category : mybatis
date: 2015/01/01 00:00:00 
title: 树结构的实现
tags : mybatis,java
---

##概述：
一般来说，树形结构在是常用的数据结构，但是在实际的应用中，很少用到，或者是用了不知道。我这里说的树不是数据结构中的树，而是在前端显示的树。通常，在前端显示树结构都是在后台构造json串，再通过js插件实现树结构，不同的插件有不同的实现方法，需要的json结构也有很多不同。

不过如果只是用来显示二级或者三级菜单的情况，引入一大堆插件也不是很好。所以不使用插件，直接显示。通常情况下都需要以下几个字段：id、name、parentId。 

具体的表结构和内容如下:



{% highlight sql %}

   id		parentId		name
   #############################################
   1			null		一级菜单1
   2			null		一级菜单2
   3			1			二级菜单1
   4			2			二级菜单2
   5			1			二级菜单3
   6			2			二级菜单4
   7			1			二级菜单5


{% endhighlight %}



##思路

###常规方法：先得到父节点，然后通过得到的父节点，循环查询该父节点下的子节点

{% highlight java %}


    public void getTree(){

        List<Integer> parentIds = new ArrayList<Integer>();

        List<Tree> trees =   treeService.getAll2();
        for (Tree tree:trees){
            List<Tree> children =  treeService.getChildren(tree.getId());
            tree.setChildren(children);
        }

        for (Tree tree :trees){
            System.out.println("当前节点是："+ tree.getName());
            System.out.println("他的子节点是：" );
            for (Tree child: tree.getChildren()){
                System.out.println(child.getName());
            }
        }



    }


{% endhighlight %}


结果：（之后的结果都是如此，不再写）



{% highlight  sql %}


当前节点是：一级菜单1
他的子节点是：
二级菜单1
二级菜单3
二级菜单5
当前节点是：一级菜单2
他的子节点是：
二级菜单2
二级菜单4

{% endhighlight %}


###第二种：使用mybaits的collection属性：这种比第一种的效率还要差，查询的次数也更多，比如查询二级菜单的时候也会进行getChildren查询，唯一的好处就是java代码少。

{% highlight xml %}


 <?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="cn.liuyiyou.springmvc.mapper.TreeMapper">

    <resultMap id="treeMap" type="cn.liuyiyou.springmvc.domain.Tree">
        <id property="id" column="id"></id>
        <result property="parentId" column="parentId" />
        <result property="parentIds" column="parentIds" />
        <result property="name" column="name" />
        <result property="type" column="type" />
        <association property="parent" column="parentId" select="getById" />
        <!--在使用上面的代码的时候下面这句话省略-->
        <collection property="children"  column="id" select="getChildren" />
    </resultMap>

    <select id="getAll" resultMap="treeMap">
        select * from tree where id in (1,2)
    </select>


    <select id="getAll2" resultMap="treeMap">
        select * from tree where parentId is null
    </select>


    <select id="getById" resultMap="treeMap">
        select * from tree where id = #{id}
    </select>


    <select id="getChildren" resultMap="treeMap">
        select * from tree where parentId = #{id}
    </select>


  </mapper>

{% endhighlight %}



{% highlight java %}


 package cn.liuyiyou.springmvc.domain;

import java.util.List;

/**
 * User: liuyiyou
 * Date: 15-1-1
 * Time: 下午8:12
 */
public class Tree {

    private int id;
    private  int parentId;
    private String parentIds;
    private String type;
    private String name;
    private int sort;
    private Tree parent;
    private List<Tree> children;

    public int getId() {
        return id;
    }

    public void setId(int id) {
        this.id = id;
    }

    public int getParentId() {
        return parentId;
    }

    public void setParentId(int parentId) {
        this.parentId = parentId;
    }

    public String getParentIds() {
        return parentIds;
    }

    public void setParentIds(String parentIds) {
        this.parentIds = parentIds;
    }

    public String getType() {
        return type;
    }

    public void setType(String type) {
        this.type = type;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getSort() {
        return sort;
    }

    public void setSort(int sort) {
        this.sort = sort;
    }

    public Tree getParent() {
        return parent;
    }

    public void setParent(Tree parent) {
        this.parent = parent;
    }

    public List<Tree> getChildren() {
        return children;
    }

    public void setChildren(List<Tree> children) {
        this.children = children;
    }
}



{% endhighlight %}


测试代码：

{% highlight java %}


@Test
    public void getAll2() {

        List<Tree> trees =  treeService.getAll2();

        for (Tree tree :trees){
            System.out.println("当前节点是："+ tree.getName());
            System.out.println("他的子节点是：" );
            for (Tree child: tree.getChildren()){
                System.out.println(child.getName());
            }
        }


    }

{% endhighlight %}


##第三种方法：通过自身join


